{"file":"D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\test\\e2e\\qrcode.e2e.spec.ts","mappings":"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","names":[],"sources":["D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\test\\e2e\\qrcode.e2e.spec.ts"],"sourcesContent":["import { ConfigModule, ConfigService } from '@nestjs/config';\r\nimport { Test, TestingModule } from '@nestjs/testing';\r\nimport { INestApplication } from '@nestjs/common';\r\nimport { ValidationPipe } from '@nestjs/common';\r\nimport { TypeOrmModule } from '@nestjs/typeorm';\r\nimport { BullModule } from '@nestjs/bullmq';\r\nimport * as dotenv from 'dotenv';\r\nimport request from 'supertest';\r\nimport * as path from 'path';\r\n\r\n// import modules\r\nimport { RateLimitModule } from '../../src/modules/rate-limit/rate-limit.module';\r\nimport { AnalyticsModule } from '../../src/modules/analytics/analytics.module';\r\nimport { SchedulerModule } from '../../src/modules/scheduler/scheduler.module';\r\nimport { QrcodeModule } from '../../src/modules/qrcode/qrcode.module';\r\nimport { AdminModule } from '../../src/modules/admin/admin.module';\r\nimport { CacheModule } from '../../src/common/cache/cache.module';\r\nimport { AuthModule } from '../../src/modules/auth/auth.module';\r\nimport { UrlModule } from '../../src/modules/url/url.module';\r\n\r\n// import entities\r\nimport { Click } from '../../src/modules/analytics/entities/click.entity';\r\nimport { ApiKey } from '../../src/modules/auth/entities/api-key.entity';\r\nimport { User } from '../../src/modules/auth/entities/user.entity';\r\nimport { Url } from '../../src/modules/url/entities/url.entity';\r\n\r\nimport { RateLimitGuard } from '../../src/modules/rate-limit/guards/rate-limit.guard';\r\nimport { cleanDatabase } from './setup';\r\n\r\ndotenv.config({ path: path.resolve(__dirname, '../../.env.test') });\r\n\r\ndescribe('QR Code Generation (E2E)', () => {\r\n  let app: INestApplication;\r\n  let accessToken: string;\r\n  let shortCode: string;\r\n\r\n  beforeAll(async () => {\r\n    const moduleFixture: TestingModule = await Test.createTestingModule({\r\n      imports: [\r\n        ConfigModule.forRoot({\r\n          isGlobal: true,\r\n          envFilePath: '.env.test',\r\n          ignoreEnvFile: false,\r\n        }),\r\n\r\n        TypeOrmModule.forRootAsync({\r\n          inject: [ConfigService],\r\n          useFactory: (configService: ConfigService) => ({\r\n            type: 'postgres',\r\n            host: configService.get('DB_HOST', 'localhost'),\r\n            port: configService.get<number>('DB_PORT', 5433),\r\n            username: configService.get('DB_USERNAME', 'test_user'),\r\n            password: configService.get('DB_PASSWORD', 'test_password'),\r\n            database: configService.get('DB_DATABASE', 'urlshortener_test_db'),\r\n            entities: [Url, User, ApiKey, Click],\r\n            synchronize: true,\r\n            dropSchema: true,\r\n            logging: false,\r\n          }),\r\n        }),\r\n\r\n        BullModule.forRootAsync({\r\n          inject: [ConfigService],\r\n          useFactory: (configService: ConfigService) => ({\r\n            connection: {\r\n              host: configService.get('REDIS_HOST', 'localhost'),\r\n              port: configService.get<number>('REDIS_PORT', 6380),\r\n              password: configService.get('REDIS_PASSWORD'),\r\n              maxRetriesPerRequest: null,\r\n              lazyConnect: true,\r\n            },\r\n          }),\r\n        }),\r\n\r\n        //   import all module\r\n        CacheModule,\r\n        UrlModule,\r\n        AnalyticsModule,\r\n        QrcodeModule,\r\n        SchedulerModule,\r\n        RateLimitModule,\r\n        AdminModule,\r\n        AuthModule,\r\n      ],\r\n    })\r\n      .overrideGuard(RateLimitGuard)\r\n      .useValue({ canActivate: () => true })\r\n      .compile();\r\n\r\n    app = moduleFixture.createNestApplication();\r\n\r\n    app.useGlobalPipes(\r\n      new ValidationPipe({\r\n        whitelist: true,\r\n        forbidNonWhitelisted: true,\r\n        transform: true,\r\n        transformOptions: {\r\n          enableImplicitConversion: true,\r\n        },\r\n      }),\r\n    );\r\n\r\n    await app.init();\r\n  });\r\n\r\n  afterAll(async () => {\r\n    await app.close();\r\n  }, 10000);\r\n\r\n  beforeEach(async () => {\r\n    await cleanDatabase();\r\n\r\n    // register user and create URL\r\n    const registerResponse = await request(app.getHttpServer())\r\n      .post('/api/auth/register')\r\n      .send({\r\n        email: 'qrcode@example.com',\r\n        name: 'QR Code User',\r\n        password: 'Password123!',\r\n      });\r\n\r\n    accessToken = registerResponse.body.accessToken;\r\n\r\n    const createResponse = await request(app.getHttpServer())\r\n      .post('/api/urls')\r\n      .set('Authorization', `Bearer ${accessToken}`)\r\n      .send({\r\n        originalUrl: 'https://example.com',\r\n      });\r\n\r\n    shortCode = createResponse.body.shortCode;\r\n  });\r\n\r\n  describe('GET /api/qrcode/:shortCode.png', () => {\r\n    it('should generate PNG QR code', async () => {\r\n      const response = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}.png`)\r\n        .expect(200);\r\n\r\n      expect(response.headers['content-type']).toBe('image/png');\r\n      expect(response.headers['cache-control']).toContain('public');\r\n      expect(response.body).toBeInstanceOf(Buffer);\r\n      expect(response.body.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should generate PNG with custom size', async () => {\r\n      const response = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}.png?size=500`)\r\n        .expect(200);\r\n\r\n      expect(response.headers['content-type']).toBe('image/png');\r\n      expect(response.body).toBeInstanceOf(Buffer);\r\n    }, 10000);\r\n\r\n    it('should generate PNG with custom colors', async () => {\r\n      const response = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}.png?dark=FF0000&light=FFFFFF`)\r\n        .expect(200);\r\n\r\n      expect(response.headers['content-type']).toBe('image/png');\r\n      expect(response.body).toBeInstanceOf(Buffer);\r\n    });\r\n\r\n    it('should reject invalid size (too small)', async () => {\r\n      await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}.png?size=50`)\r\n        .expect(400);\r\n    });\r\n\r\n    it('should reject invalid size (too large)', async () => {\r\n      await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}.png?size=3000`)\r\n        .expect(400);\r\n    });\r\n\r\n    it('should handle non-existent short code', async () => {\r\n      const response = await request(app.getHttpServer())\r\n        .get('/api/qrcode/nonexistent.png')\r\n        .expect(200);\r\n\r\n      // QR code is generated regardless, but points to invalid URL\r\n      expect(response.body).toBeInstanceOf(Buffer);\r\n    });\r\n  });\r\n\r\n  describe('GET /api/qrcode/:shortCode.svg', () => {\r\n    it('should generate SVG QR code', async () => {\r\n      const response = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}.svg`)\r\n        .expect(200);\r\n\r\n      expect(response.headers['content-type']).toBe(\r\n        'image/svg+xml; charset=utf-8',\r\n      );\r\n      expect(response.headers['cache-control']).toContain('public');\r\n      expect(response.type).toContain('svg');\r\n    });\r\n\r\n    it('should generate SVG with custom size', async () => {\r\n      const response = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}.svg?size=400`)\r\n        .expect(200);\r\n\r\n      expect(response.headers['content-type']).toBe(\r\n        'image/svg+xml; charset=utf-8',\r\n      );\r\n      expect(response.type).toContain('svg');\r\n    });\r\n\r\n    it('should generate SVG with custom colors', async () => {\r\n      const response = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}.svg?dark=0000FF&light=FFFF00`)\r\n        .expect(200);\r\n\r\n      expect(response.type).toContain('svg');\r\n    });\r\n  });\r\n\r\n  describe('GET /api/qrcode/:shortCode', () => {\r\n    it('should return QR code as Data URL', async () => {\r\n      const response = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}`)\r\n        .expect(200);\r\n\r\n      expect(response.body).toHaveProperty('qrCode');\r\n      expect(response.body).toHaveProperty('shortCode', shortCode);\r\n      expect(response.body.qrCode).toMatch(/^data:image\\/png;base64,/);\r\n    });\r\n\r\n    it('should return Data URL with custom size', async () => {\r\n      const response = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}?size=300`)\r\n        .expect(200);\r\n\r\n      expect(response.body.qrCode).toMatch(/^data:image\\/png;base64,/);\r\n    });\r\n\r\n    it('should return Data URL with custom colors', async () => {\r\n      const response = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}?dark=000000&light=FFFFFF`)\r\n        .expect(200);\r\n\r\n      expect(response.body.qrCode).toMatch(/^data:image\\/png;base64,/);\r\n    });\r\n  });\r\n\r\n  describe('QR Code Caching', () => {\r\n    it('should cache QR code responses', async () => {\r\n      // first request\r\n      const response1 = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}.png`)\r\n        .expect(200);\r\n\r\n      // second request (should be cached)\r\n      const response2 = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}.png`)\r\n        .expect(200);\r\n\r\n      // verify cache headers\r\n      expect(response2.headers['cache-control']).toBeDefined();\r\n      expect(response2.headers['cache-control']).toContain('public');\r\n\r\n      // both should return valid images\r\n      expect(response1.body).toBeInstanceOf(Buffer);\r\n      expect(response2.body).toBeInstanceOf(Buffer);\r\n    });\r\n  });\r\n\r\n  describe('QR Code with Different Parameters', () => {\r\n    it('should generate different QR codes for different URLs', async () => {\r\n      // create second URL\r\n      const createResponse2 = await request(app.getHttpServer())\r\n        .post('/api/urls')\r\n        .set('Authorization', `Bearer ${accessToken}`)\r\n        .send({\r\n          originalUrl: 'https://another-example.com',\r\n        });\r\n\r\n      const shortCode2 = createResponse2.body.shortCode;\r\n\r\n      // get QR codes\r\n      const response1 = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode}.png`)\r\n        .expect(200);\r\n\r\n      const response2 = await request(app.getHttpServer())\r\n        .get(`/api/qrcode/${shortCode2}.png`)\r\n        .expect(200);\r\n\r\n      // QR codes should be different\r\n      expect(response1.body).not.toEqual(response2.body);\r\n    }, 10000);\r\n  });\r\n});\r\n"],"version":3}