{"version":3,"names":["common_1","cov_1zuol11mcn","s","require","swagger_1","rate_limit_decorator_1","rate_limit_guard_1","current_user_decorator_1","refresh_token_dto_1","jwt_auth_guard_1","public_decorator_1","register_dto_1","auth_service_1","login_dto_1","AuthController","authService","constructor","f","register","registerDto","result","user","id","email","name","role","accessToken","refreshToken","login","loginDto","refresh","refreshTokenDto","token","refreshAccessToken","logout","getProfile","fullUser","getUserById","isEmailVerified","createdAt","exports","__decorate","ApiOperation","summary","ApiResponse","status","description","Public","Post","HttpCode","HttpStatus","CREATED","__param","Body","RegisterDto","b","_b","Object","RateLimit","ttl","max","OK","LoginDto","_c","RefreshTokenDto","_d","ApiBearerAuth","UseGuards","JwtAuthGuard","NO_CONTENT","CurrentUser","Get","ApiTags","RateLimitGuard","Controller","AuthService","_a"],"sources":["D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\src\\modules\\auth\\auth.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Post,\r\n  Body,\r\n  Get,\r\n  UseGuards,\r\n  HttpCode,\r\n  HttpStatus,\r\n  Patch,\r\n} from '@nestjs/common';\r\nimport {\r\n  ApiTags,\r\n  ApiOperation,\r\n  ApiResponse,\r\n  ApiBearerAuth,\r\n} from '@nestjs/swagger';\r\n\r\nimport { RateLimit } from '../rate-limit/decorators/rate-limit.decorator';\r\nimport { RateLimitGuard } from '../rate-limit/guards/rate-limit.guard';\r\nimport { CurrentUser } from './decorators/current-user.decorator';\r\nimport { RefreshTokenDto } from './dto/refresh-token.dto';\r\nimport { JwtAuthGuard } from './guards/jwt-auth.guard';\r\nimport { Public } from './decorators/public.decorator';\r\nimport { RegisterDto } from './dto/register.dto';\r\nimport { User } from './entities/user.entity';\r\nimport { AuthService } from './auth.service';\r\nimport { LoginDto } from './dto/login.dto';\r\n\r\n/* \r\nAuth Controller - authentication endpoints\r\n*/\r\n@ApiTags('auth')\r\n@UseGuards(RateLimitGuard)\r\n@Controller('api/auth')\r\nexport class AuthController {\r\n  constructor(private readonly authService: AuthService) {}\r\n\r\n  /* \r\n  Register new user\r\n  */\r\n  @ApiOperation({ summary: 'Register new user' })\r\n  @ApiResponse({ status: 201, description: 'User registered successfully' })\r\n  @ApiResponse({ status: 409, description: 'Email already registered' })\r\n  @Public()\r\n  @Post('register')\r\n  @HttpCode(HttpStatus.CREATED)\r\n  async register(@Body() registerDto: RegisterDto) {\r\n    const result = await this.authService.register(registerDto);\r\n\r\n    return {\r\n      user: {\r\n        id: result.user.id,\r\n        email: result.user.email,\r\n        name: result.user.name,\r\n        role: result.user.role,\r\n      },\r\n      accessToken: result.accessToken,\r\n      refreshToken: result.refreshToken,\r\n    };\r\n  }\r\n\r\n  /* \r\n  Login user\r\n  */\r\n  @ApiOperation({ summary: 'Login' })\r\n  @ApiResponse({ status: 201, description: 'User registered successfully' })\r\n  @ApiResponse({ status: 401, description: 'Email or password is wrong' })\r\n  @Public()\r\n  @Post('login')\r\n  @RateLimit({ ttl: 60, max: 5 })\r\n  @HttpCode(HttpStatus.OK)\r\n  async login(@Body() loginDto: LoginDto) {\r\n    const result = await this.authService.login(loginDto);\r\n\r\n    return {\r\n      user: {\r\n        id: result.user.id,\r\n        email: result.user.email,\r\n        name: result.user.name,\r\n        role: result.user.role,\r\n      },\r\n      accessToken: result.accessToken,\r\n      refreshToken: result.refreshToken,\r\n    };\r\n  }\r\n\r\n  /* \r\n  Refresh access token\r\n  */\r\n  @ApiOperation({ summary: 'Refresh token' })\r\n  @ApiResponse({ status: 200 })\r\n  @ApiResponse({ status: 401, description: 'Invalid refresh token' })\r\n  @Public()\r\n  @Post('refresh')\r\n  @HttpCode(HttpStatus.OK)\r\n  async refresh(@Body() refreshTokenDto: RefreshTokenDto) {\r\n    const token = await this.authService.refreshAccessToken(\r\n      refreshTokenDto.refreshToken,\r\n    );\r\n\r\n    return token;\r\n  }\r\n\r\n  /* \r\n  Logout user\r\n  */\r\n  @ApiOperation({ summary: 'Logout' })\r\n  @ApiResponse({ status: 204 })\r\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\r\n  @ApiBearerAuth()\r\n  @UseGuards(JwtAuthGuard)\r\n  @Post('logout')\r\n  @HttpCode(HttpStatus.NO_CONTENT)\r\n  async logout(@CurrentUser() user: any) {\r\n    await this.authService.logout(user.id);\r\n  }\r\n\r\n  /* \r\n  Get current user profile\r\n  */\r\n  @ApiOperation({ summary: 'Get current user profile' })\r\n  @ApiResponse({ status: 200 })\r\n  @ApiResponse({ status: 404, description: 'User not found' })\r\n  @ApiBearerAuth()\r\n  @UseGuards(JwtAuthGuard)\r\n  @Get('me')\r\n  async getProfile(@CurrentUser() user: any) {\r\n    const fullUser = await this.authService.getUserById(user.id);\r\n\r\n    return {\r\n      id: fullUser.id,\r\n      email: fullUser.email,\r\n      name: fullUser.name,\r\n      role: fullUser.role,\r\n      isEmailVerified: fullUser.isEmailVerified,\r\n      createdAt: fullUser.createdAt,\r\n    };\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}