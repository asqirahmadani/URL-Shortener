{"file":"D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\test\\unit\\analytics.service.spec.ts","mappings":"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","names":[],"sources":["D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\test\\unit\\analytics.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\r\nimport { getRepositoryToken } from '@nestjs/typeorm';\r\nimport { NotFoundException } from '@nestjs/common';\r\nimport { getQueueToken } from '@nestjs/bullmq';\r\nimport { Repository } from 'typeorm';\r\n\r\nimport { UserAgentParser } from '../../src/modules/analytics/utils/user-agent.parser';\r\nimport { AnalyticsService } from '../../src/modules/analytics/analytics.service';\r\nimport { GeoIpService } from '../../src/modules/analytics/utils/geo-ip.service';\r\nimport { Click } from '../../src/modules/analytics/entities/click.entity';\r\nimport { CacheService } from '../../src/common/cache/cache.service';\r\nimport { Url } from '../../src/modules/url/entities/url.entity';\r\n\r\ndescribe('AnalyticsService', () => {\r\n  let service: AnalyticsService;\r\n  let clickRepository: Repository<Click>;\r\n  let urlRepository: Repository<Url>;\r\n  let queue: any;\r\n  let cacheService: CacheService;\r\n\r\n  const mockQueue = {\r\n    add: jest.fn(),\r\n  };\r\n\r\n  const mockClickRepository = {\r\n    create: jest.fn(),\r\n    save: jest.fn(),\r\n    count: jest.fn(),\r\n    find: jest.fn(),\r\n    findOne: jest.fn(),\r\n    createQueryBuilder: jest.fn(),\r\n  };\r\n\r\n  const mockUrlRepository = {\r\n    findOne: jest.fn(),\r\n    increment: jest.fn(),\r\n  };\r\n\r\n  const mockUserAgentParser = {\r\n    parse: jest.fn(),\r\n  };\r\n\r\n  const mockGeoIpService = {\r\n    getLocation: jest.fn(),\r\n  };\r\n\r\n  const mockCacheService = {\r\n    get: jest.fn(),\r\n    set: jest.fn(),\r\n    wrap: jest.fn(),\r\n    analyticsOverviewKey: jest.fn((code) => `analytics:overview:${code}`),\r\n    analyticsTimelineKey: jest.fn(\r\n      (code, interval, days) =>\r\n        `analytics:timeline:${code}:${interval}:${days}`,\r\n    ),\r\n    analyticsLocationsKey: jest.fn((code) => `analytics:locations:${code}`),\r\n    analyticsDevicesKey: jest.fn((code) => `analytics:devices:${code}`),\r\n    analyticsReferrersKey: jest.fn((code) => `analytics:referrers:${code}`),\r\n    getTTL: jest.fn(() => 600),\r\n    invalidateAnalyticsCache: jest.fn(),\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    const module: TestingModule = await Test.createTestingModule({\r\n      providers: [\r\n        AnalyticsService,\r\n        {\r\n          provide: getRepositoryToken(Click),\r\n          useValue: mockClickRepository,\r\n        },\r\n        {\r\n          provide: getRepositoryToken(Url),\r\n          useValue: mockUrlRepository,\r\n        },\r\n        {\r\n          provide: getQueueToken('clicks'),\r\n          useValue: mockQueue,\r\n        },\r\n        {\r\n          provide: UserAgentParser,\r\n          useValue: mockUserAgentParser,\r\n        },\r\n        {\r\n          provide: GeoIpService,\r\n          useValue: mockGeoIpService,\r\n        },\r\n        {\r\n          provide: CacheService,\r\n          useValue: mockCacheService,\r\n        },\r\n      ],\r\n    }).compile();\r\n\r\n    service = module.get<AnalyticsService>(AnalyticsService);\r\n    clickRepository = module.get(getRepositoryToken(Click));\r\n    urlRepository = module.get(getRepositoryToken(Url));\r\n    queue = module.get(getQueueToken('clicks'));\r\n    cacheService = module.get<CacheService>(CacheService);\r\n  });\r\n\r\n  afterEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('enqueueClickEvent', () => {\r\n    it('should add job to queue', async () => {\r\n      const clickEvent = {\r\n        urlId: 'uuid',\r\n        ipAddress: '8.8.8.8',\r\n        userAgent: 'Mozilla/5.0...',\r\n        referer: 'https://google.com',\r\n      };\r\n\r\n      mockQueue.add.mockResolvedValue({ id: 'job-123' });\r\n\r\n      await service.enqueueClickEvent(clickEvent);\r\n\r\n      expect(mockQueue.add).toHaveBeenCalledWith(\r\n        'record-click',\r\n        clickEvent,\r\n        expect.objectContaining({\r\n          attempts: 3,\r\n          backoff: expect.any(Object),\r\n        }),\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('processClickEvent', () => {\r\n    it('should parse UA, get geo, and save click', async () => {\r\n      const clickEvent = {\r\n        urlId: 'uuid',\r\n        ipAddress: '8.8.8.8',\r\n        userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0)',\r\n        referer: 'https://google.com',\r\n      };\r\n\r\n      mockUserAgentParser.parse.mockReturnValue({\r\n        browser: 'Mobile Safari',\r\n        browserVersion: '14.0',\r\n        os: 'iOS',\r\n        osVersion: '14.0',\r\n        deviceType: 'mobile',\r\n      });\r\n\r\n      mockGeoIpService.getLocation.mockReturnValue({\r\n        country: 'US',\r\n        city: 'Mountain View',\r\n        latitude: 37.386,\r\n        longitude: -122.084,\r\n        timezone: 'America/Los_Angeles',\r\n      });\r\n\r\n      mockClickRepository.create.mockReturnValue({\r\n        id: 'click-uuid',\r\n        ...clickEvent,\r\n      });\r\n      mockClickRepository.save.mockResolvedValue({ id: 'click-uuid' });\r\n      mockUrlRepository.increment.mockResolvedValue({});\r\n\r\n      await service.processClickEvent(clickEvent);\r\n\r\n      expect(mockUserAgentParser.parse).toHaveBeenCalledWith(\r\n        clickEvent.userAgent,\r\n      );\r\n      expect(mockGeoIpService.getLocation).toHaveBeenCalledWith(\r\n        clickEvent.ipAddress,\r\n      );\r\n      expect(mockClickRepository.save).toHaveBeenCalled();\r\n      expect(mockUrlRepository.increment).toHaveBeenCalledWith(\r\n        { id: 'uuid' },\r\n        'clickCount',\r\n        1,\r\n      );\r\n    });\r\n\r\n    it('should handle missing user agent gracefully', async () => {\r\n      const clickEvent = {\r\n        urlId: 'uuid',\r\n        ipAddress: '8.8.8.8',\r\n        userAgent: '',\r\n        referer: '',\r\n      };\r\n\r\n      mockUserAgentParser.parse.mockReturnValue({\r\n        browser: null,\r\n        browserVersion: null,\r\n        os: null,\r\n        osVersion: null,\r\n        deviceType: null,\r\n      });\r\n\r\n      mockGeoIpService.getLocation.mockReturnValue({\r\n        country: null,\r\n        city: null,\r\n        latitude: null,\r\n        longitude: null,\r\n        timezone: null,\r\n      });\r\n\r\n      mockClickRepository.create.mockReturnValue({});\r\n      mockClickRepository.save.mockResolvedValue({});\r\n      mockUrlRepository.increment.mockResolvedValue({});\r\n\r\n      await service.processClickEvent(clickEvent);\r\n\r\n      expect(mockClickRepository.save).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('getAnalyticsOverview', () => {\r\n    it('should return analytics overview', async () => {\r\n      const mockUrl = {\r\n        id: 'uuid',\r\n        shortCode: 'abc123',\r\n        createdAt: new Date('2025-01-01'),\r\n      };\r\n\r\n      const mockUser = {\r\n        role: 'admin',\r\n      };\r\n\r\n      const mockOverview = {\r\n        totalClicks: 100,\r\n        uniqueVisitors: 50,\r\n        topCountry: 'US',\r\n        topDevice: 'mobile',\r\n        topBrowser: 'Chrome',\r\n        averageClicksPerDay: 10,\r\n        lastClickAt: new Date(),\r\n        createdAt: mockUrl.createdAt,\r\n      };\r\n\r\n      mockUrlRepository.findOne.mockResolvedValue(mockUrl);\r\n      mockCacheService.wrap.mockImplementation(async (key, fallback) => {\r\n        return fallback();\r\n      });\r\n      mockClickRepository.count.mockResolvedValue(100);\r\n\r\n      const mockQueryBuilder = {\r\n        select: jest.fn().mockReturnThis(),\r\n        addSelect: jest.fn().mockReturnThis(),\r\n        where: jest.fn().mockReturnThis(),\r\n        andWhere: jest.fn().mockReturnThis(),\r\n        groupBy: jest.fn().mockReturnThis(),\r\n        orderBy: jest.fn().mockReturnThis(),\r\n        limit: jest.fn().mockReturnThis(),\r\n        getRawOne: jest.fn().mockResolvedValue({ count: '50' }),\r\n      };\r\n\r\n      mockClickRepository.createQueryBuilder.mockReturnValue(mockQueryBuilder);\r\n      mockClickRepository.findOne.mockResolvedValue({\r\n        createdAt: new Date(),\r\n      });\r\n\r\n      const result = await service.getAnalyticsOverview('abc123', mockUser);\r\n\r\n      expect(result.totalClicks).toBeDefined();\r\n      expect(mockUrlRepository.findOne).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should throw NotFoundException for non-existent URL', async () => {\r\n      const mockUser = {\r\n        role: 'admin',\r\n      };\r\n\r\n      mockUrlRepository.findOne.mockResolvedValue(null);\r\n\r\n      await expect(\r\n        service.getAnalyticsOverview('notfound', mockUser),\r\n      ).rejects.toThrow(NotFoundException);\r\n    });\r\n  });\r\n\r\n  describe('getTimelineData', () => {\r\n    it('should return timeline data', async () => {\r\n      const mockUrl = {\r\n        id: 'uuid',\r\n        shortCode: 'abc123',\r\n      };\r\n\r\n      const mockUser = {\r\n        role: 'admin',\r\n      };\r\n\r\n      const mockTimeline = {\r\n        data: [\r\n          { timestamp: '2025-01-01T00:00:00Z', clicks: 10 },\r\n          { timestamp: '2025-01-02T00:00:00Z', clicks: 15 },\r\n        ],\r\n        interval: 'day',\r\n        totalClicks: 25,\r\n      };\r\n\r\n      mockUrlRepository.findOne.mockResolvedValue(mockUrl);\r\n      mockCacheService.wrap.mockImplementation(async (key, fallback) => {\r\n        return fallback();\r\n      });\r\n\r\n      const mockQueryBuilder = {\r\n        select: jest.fn().mockReturnThis(),\r\n        addSelect: jest.fn().mockReturnThis(),\r\n        where: jest.fn().mockReturnThis(),\r\n        andWhere: jest.fn().mockReturnThis(),\r\n        groupBy: jest.fn().mockReturnThis(),\r\n        orderBy: jest.fn().mockReturnThis(),\r\n        getRawMany: jest.fn().mockResolvedValue([\r\n          { timestamp: '2025-01-01T00:00:00Z', clicks: '10' },\r\n          { timestamp: '2025-01-02T00:00:00Z', clicks: '15' },\r\n        ]),\r\n      };\r\n\r\n      mockClickRepository.createQueryBuilder.mockReturnValue(mockQueryBuilder);\r\n\r\n      const result = await service.getTimelineData(\r\n        'abc123',\r\n        'day',\r\n        7,\r\n        mockUser,\r\n      );\r\n\r\n      expect(result).toHaveProperty('data');\r\n      expect(result).toHaveProperty('interval');\r\n      expect(result).toHaveProperty('totalClicks');\r\n    });\r\n  });\r\n\r\n  describe('getLocationStats', () => {\r\n    it('should return location statistics', async () => {\r\n      const mockUrl = { id: 'uuid', shortCode: 'abc123' };\r\n\r\n      const mockUser = {\r\n        role: 'admin',\r\n      };\r\n\r\n      mockUrlRepository.findOne.mockResolvedValue(mockUrl);\r\n      mockCacheService.wrap.mockImplementation(async (key, fallback) => {\r\n        return fallback();\r\n      });\r\n\r\n      const mockQueryBuilder = {\r\n        select: jest.fn().mockReturnThis(),\r\n        addSelect: jest.fn().mockReturnThis(),\r\n        where: jest.fn().mockReturnThis(),\r\n        andWhere: jest.fn().mockReturnThis(),\r\n        groupBy: jest.fn().mockReturnThis(),\r\n        orderBy: jest.fn().mockReturnThis(),\r\n        limit: jest.fn().mockReturnThis(),\r\n        getRawMany: jest.fn().mockResolvedValue([\r\n          { countryCode: 'US', clicks: '50' },\r\n          { countryCode: 'ID', clicks: '30' },\r\n        ]),\r\n      };\r\n\r\n      mockClickRepository.createQueryBuilder.mockReturnValue(mockQueryBuilder);\r\n\r\n      const result = await service.getLocationStats('abc123', mockUser);\r\n\r\n      expect(result).toHaveProperty('countries');\r\n      expect(result).toHaveProperty('cities');\r\n      expect(result.countries).toBeInstanceOf(Array);\r\n    });\r\n  });\r\n\r\n  describe('getDeviceStats', () => {\r\n    it('should return device statistics', async () => {\r\n      const mockUrl = { id: 'uuid', shortCode: 'abc123' };\r\n\r\n      const mockUser = {\r\n        role: 'admin',\r\n      };\r\n\r\n      mockUrlRepository.findOne.mockResolvedValue(mockUrl);\r\n      mockCacheService.wrap.mockImplementation(async (key, fallback) => {\r\n        return fallback();\r\n      });\r\n\r\n      const mockQueryBuilder = {\r\n        select: jest.fn().mockReturnThis(),\r\n        addSelect: jest.fn().mockReturnThis(),\r\n        where: jest.fn().mockReturnThis(),\r\n        andWhere: jest.fn().mockReturnThis(),\r\n        groupBy: jest.fn().mockReturnThis(),\r\n        orderBy: jest.fn().mockReturnThis(),\r\n        limit: jest.fn().mockReturnThis(),\r\n        getRawMany: jest.fn().mockResolvedValue([\r\n          { deviceType: 'mobile', clicks: '60' },\r\n          { deviceType: 'desktop', clicks: '40' },\r\n        ]),\r\n      };\r\n\r\n      mockClickRepository.createQueryBuilder.mockReturnValue(mockQueryBuilder);\r\n\r\n      const result = await service.getDeviceStats('abc123', mockUser);\r\n\r\n      expect(result).toHaveProperty('byType');\r\n      expect(result).toHaveProperty('byBrowser');\r\n      expect(result).toHaveProperty('byOS');\r\n    });\r\n  });\r\n\r\n  describe('exportAnalytics', () => {\r\n    it('should export analytics as CSV', async () => {\r\n      const mockUrl = { id: 'uuid', shortCode: 'abc123' };\r\n      const mockUser = { role: 'admin' };\r\n      const mockClicks = [\r\n        {\r\n          createdAt: new Date(),\r\n          ipAddress: '8.8.8.8',\r\n          country: 'US',\r\n          city: 'NYC',\r\n          deviceType: 'mobile',\r\n          browser: 'Chrome',\r\n          os: 'iOS',\r\n          referer: 'https://google.com',\r\n        },\r\n      ];\r\n\r\n      mockUrlRepository.findOne.mockResolvedValue(mockUrl);\r\n      mockClickRepository.find.mockResolvedValue(mockClicks);\r\n\r\n      const result = await service.exportAnalytics('abc123', mockUser);\r\n\r\n      expect(result).toContain('Timestamp');\r\n      expect(result).toContain('IP Address');\r\n      expect(result).toContain('Country');\r\n    });\r\n  });\r\n});\r\n"],"version":3}