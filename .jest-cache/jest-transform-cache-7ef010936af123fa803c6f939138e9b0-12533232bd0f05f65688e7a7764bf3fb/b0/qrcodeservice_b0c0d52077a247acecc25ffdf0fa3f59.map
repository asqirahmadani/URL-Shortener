{"version":3,"names":["common_1","cov_7wxm4opxv","s","require","config_1","QRCode","__importStar","QrCodeService","QrCodeService_1","configService","logger","Logger","name","baseUrl","constructor","f","get","generatePNG","shortCode","options","url","qrOptions","type","width","b","size","margin","color","dark","light","errorCorrectionLevel","buffer","toBuffer","debug","error","message","BadRequestException","generateSVG","svg","toString","generateDataURL","dataURL","toDataURL","generateWithLogo","logoBuffer","exports","__decorate","Injectable","ConfigService","_a","Object"],"sources":["D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\src\\modules\\qrcode\\qrcode.service.ts"],"sourcesContent":["import { Injectable, Logger, BadRequestException } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport * as QRCode from 'qrcode';\r\n\r\n/* \r\nQR Code Service - Generate QR codes for short URLs\r\n*/\r\n@Injectable()\r\nexport class QrCodeService {\r\n  private readonly logger = new Logger(QrCodeService.name);\r\n  private readonly baseUrl: string;\r\n\r\n  constructor(private readonly configService: ConfigService) {\r\n    this.baseUrl = this.configService.get<string>('BASE_URL')!;\r\n  }\r\n\r\n  /* \r\n  Generate QR Code as PNG buffer\r\n  */\r\n  async generatePNG(\r\n    shortCode: string,\r\n    options?: {\r\n      size?: number;\r\n      margin?: number;\r\n      color?: { dark?: string; light?: string };\r\n    },\r\n  ): Promise<Buffer> {\r\n    const url = `${this.baseUrl}/${shortCode}`;\r\n\r\n    try {\r\n      const qrOptions: QRCode.QRCodeToBufferOptions = {\r\n        type: 'png',\r\n        width: options?.size || 300,\r\n        margin: options?.margin || 1,\r\n        color: {\r\n          dark: options?.color?.dark || '#000000',\r\n          light: options?.color?.light || '#FFFFFF',\r\n        },\r\n        errorCorrectionLevel: 'M',\r\n      };\r\n\r\n      const buffer = await QRCode.toBuffer(url, qrOptions);\r\n      this.logger.debug(`Generated PNG QR code for ${shortCode}`);\r\n      return buffer;\r\n    } catch (error) {\r\n      this.logger.error(`Failed to generate QR code: ${error.message}`);\r\n      throw new BadRequestException('Failed to generate QR code');\r\n    }\r\n  }\r\n\r\n  /* \r\n  Generate QR Code as SVG string\r\n  */\r\n  async generateSVG(\r\n    shortCode: string,\r\n    options?: {\r\n      size?: number;\r\n      margin?: number;\r\n      color?: { dark?: string; light?: string };\r\n    },\r\n  ): Promise<string> {\r\n    const url = `${this.baseUrl}/${shortCode}`;\r\n\r\n    try {\r\n      const qrOptions: QRCode.QRCodeToStringOptions = {\r\n        type: 'svg',\r\n        width: options?.size || 300,\r\n        margin: options?.margin || 1,\r\n        color: {\r\n          dark: options?.color?.dark || '#000000',\r\n          light: options?.color?.light || '#FFFFFF',\r\n        },\r\n      };\r\n\r\n      const svg = await QRCode.toString(url, qrOptions);\r\n      this.logger.debug(`Generated SVG QR code for ${shortCode}`);\r\n      return svg;\r\n    } catch (error) {\r\n      this.logger.error(`Failed to generate SVG QR code: ${error.message}`);\r\n      throw new BadRequestException('Failed to generate QR code');\r\n    }\r\n  }\r\n\r\n  /* \r\n  Generate QR Code as URL Data (base64)\r\n  */\r\n  async generateDataURL(\r\n    shortCode: string,\r\n    options?: {\r\n      size?: number;\r\n      margin?: number;\r\n      color?: { dark?: string; light?: string };\r\n    },\r\n  ): Promise<string> {\r\n    const url = `${this.baseUrl}/${shortCode}`;\r\n\r\n    try {\r\n      const qrOptions: QRCode.QRCodeToDataURLOptions = {\r\n        width: options?.size || 300,\r\n        margin: options?.margin || 1,\r\n        color: {\r\n          dark: options?.color?.dark || '#000000',\r\n          light: options?.color?.light || '#FFFFFF',\r\n        },\r\n      };\r\n\r\n      const dataURL = await QRCode.toDataURL(url, qrOptions);\r\n      this.logger.debug(`Generated Data URL QR code for ${shortCode}`);\r\n      return dataURL;\r\n    } catch (error) {\r\n      this.logger.error(\r\n        `Failed to generate Data URL QR code: ${error.message}`,\r\n      );\r\n      throw new BadRequestException('Failed to generate QR code');\r\n    }\r\n  }\r\n\r\n  /* \r\n  Generate QR Code with logo/image in the middle\r\n  */\r\n  async generateWithLogo(\r\n    shortCode: string,\r\n    logoBuffer: Buffer,\r\n  ): Promise<Buffer> {\r\n    // TODO: implement with sharp for merge QR + logo\r\n    return this.generatePNG(shortCode);\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}