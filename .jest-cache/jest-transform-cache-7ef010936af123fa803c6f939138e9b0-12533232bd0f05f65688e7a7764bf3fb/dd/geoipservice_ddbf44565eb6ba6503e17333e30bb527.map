{"version":3,"names":["common_1","cov_18hwyyc1c9","s","require","config_1","axios_1","rxjs_1","geoip_lite_1","__importDefault","GeoIpService","GeoIpService_1","configService","httpService","logger","Logger","name","isDevelopment","useApiLookup","constructor","f","get","getLocation","ipAddress","normalizedIP","normalizeIP","debug","b","isPrivateIP","getMockLocation","getNullLocation","geo","default","lookup","country","city","latitude","ll","longitude","timezone","error","message","lookupLocal","lookupApi","response","firstValueFrom","timeout","data","status","countryCode","lat","lon","hash","includes","segments","split","filter","lastSegment","length","parseInt","octets","mockIndex","mockLocations","location","ip","startsWith","substring","privateRanges","some","range","test","exports","__decorate","Injectable","ConfigService","_a","Object","_b","HttpService"],"sources":["D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\src\\modules\\analytics\\utils\\geo-ip.service.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { HttpService } from '@nestjs/axios';\r\nimport { firstValueFrom } from 'rxjs';\r\nimport geoip from 'geoip-lite';\r\n\r\nexport interface GeoLocation {\r\n  country: string | null;\r\n  city: string | null;\r\n  latitude: number | null;\r\n  longitude: number | null;\r\n  timezone: string | null;\r\n}\r\n\r\n/* \r\nGeoIP Service - Multi-source location lookup\r\n1. geoip-lite\r\n2. ip-api.com\r\n3. Mock data (development)\r\n*/\r\n@Injectable()\r\nexport class GeoIpService {\r\n  private readonly logger = new Logger(GeoIpService.name);\r\n  private readonly isDevelopment: boolean;\r\n  private readonly useApiLookup: boolean;\r\n\r\n  constructor(\r\n    private readonly configService: ConfigService,\r\n    private readonly httpService: HttpService,\r\n  ) {\r\n    this.isDevelopment = this.configService.get('NODE_ENV') !== 'production';\r\n    this.useApiLookup =\r\n      this.configService.get('GEOIP_USE_API', 'false') === 'true';\r\n  }\r\n\r\n  async getLocation(ipAddress: string): Promise<GeoLocation> {\r\n    const normalizedIP = this.normalizeIP(ipAddress);\r\n\r\n    this.logger.debug(\r\n      `Original IP: ${ipAddress} â†’ Normalized: ${normalizedIP}`,\r\n    );\r\n\r\n    // Development: Mock data for private IPs\r\n    if (this.isDevelopment && this.isPrivateIP(normalizedIP)) {\r\n      this.logger.debug(\r\n        `Private IP detected: ${normalizedIP} - Using mock data`,\r\n      );\r\n      return this.getMockLocation(normalizedIP);\r\n    }\r\n\r\n    // Private IP in production\r\n    if (this.isPrivateIP(normalizedIP)) {\r\n      this.logger.debug(`Private IP in production: ${normalizedIP}`);\r\n      return this.getNullLocation();\r\n    }\r\n\r\n    // Lookup real IP\r\n    try {\r\n      const geo = geoip.lookup(normalizedIP);\r\n\r\n      if (!geo) {\r\n        this.logger.debug(`GeoIP lookup failed for: ${normalizedIP}`);\r\n        return this.getNullLocation();\r\n      }\r\n\r\n      return {\r\n        country: geo.country || null,\r\n        city: geo.city || null,\r\n        latitude: geo.ll ? geo.ll[0] : null,\r\n        longitude: geo.ll ? geo.ll[1] : null,\r\n        timezone: geo.timezone || null,\r\n      };\r\n    } catch (error) {\r\n      this.logger.error(`GeoIP error for ${normalizedIP}: ${error.message}`);\r\n      return this.getNullLocation();\r\n    }\r\n  }\r\n\r\n  /* \r\n  Local GeoIP lookup (geoip-lite)\r\n  */\r\n  private lookupLocal(ipAddress: string): GeoLocation {\r\n    try {\r\n      const geo = geoip.lookup(ipAddress);\r\n\r\n      if (!geo) {\r\n        return this.getNullLocation();\r\n      }\r\n\r\n      return {\r\n        country: geo.country || null,\r\n        city: geo.city || null,\r\n        latitude: geo.ll ? geo.ll[0] : null,\r\n        longitude: geo.ll ? geo.ll[1] : null,\r\n        timezone: geo.timezone || null,\r\n      };\r\n    } catch (error) {\r\n      this.logger.error(`Local GeoIP error for ${ipAddress}: ${error.message}`);\r\n      return this.getNullLocation();\r\n    }\r\n  }\r\n\r\n  /* \r\n  API GeoIP lookup\r\n  */\r\n  private async lookupApi(ipAddress: string): Promise<GeoLocation> {\r\n    try {\r\n      const response = await firstValueFrom(\r\n        this.httpService.get(`http://ip-api.com/json/${ipAddress}`, {\r\n          timeout: 3000,\r\n        }),\r\n      );\r\n\r\n      const data = response.data;\r\n\r\n      if (data.status === 'fail') {\r\n        this.logger.debug(\r\n          `API lookup failed for ${ipAddress}: ${data.message}`,\r\n        );\r\n        return this.getNullLocation();\r\n      }\r\n\r\n      return {\r\n        country: data.countryCode || null,\r\n        city: data.city || null,\r\n        latitude: data.lat || null,\r\n        longitude: data.lon || null,\r\n        timezone: data.timezone || null,\r\n      };\r\n    } catch (error) {\r\n      this.logger.error(`API GeoIP error for ${ipAddress}: ${error.message}`);\r\n      return this.getNullLocation();\r\n    }\r\n  }\r\n\r\n  private getMockLocation(ipAddress: string): GeoLocation {\r\n    let hash = 0;\r\n\r\n    if (ipAddress.includes(':')) {\r\n      // IPv6: Use last segment\r\n      const segments = ipAddress.split(':').filter((s) => s);\r\n      const lastSegment = segments[segments.length - 1] || '0';\r\n      hash = parseInt(lastSegment, 16) || 0;\r\n    } else {\r\n      // IPv4: Use last octet\r\n      const octets = ipAddress.split('.');\r\n      hash = parseInt(octets[octets.length - 1] || '0', 10);\r\n    }\r\n\r\n    const mockIndex = hash % this.mockLocations.length;\r\n    const location = this.mockLocations[mockIndex];\r\n\r\n    this.logger.debug(\r\n      `Mock location for ${ipAddress}: ${location.city}, ${location.country}`,\r\n    );\r\n\r\n    return location;\r\n  }\r\n\r\n  private normalizeIP(ip: string): string {\r\n    if (ip.startsWith('::ffff:')) {\r\n      return ip.substring(7);\r\n    }\r\n\r\n    if (ip.startsWith('::') && ip.includes('.')) {\r\n      return ip.substring(2); // Remove '::' prefix\r\n    }\r\n\r\n    return ip;\r\n  }\r\n\r\n  private isPrivateIP(ip: string): boolean {\r\n    const privateRanges = [\r\n      // IPv4 localhost\r\n      /^127\\./,\r\n\r\n      // IPv4 private ranges\r\n      /^10\\./,\r\n      /^172\\.(1[6-9]|2\\d|3[01])\\./,\r\n      /^192\\.168\\./,\r\n\r\n      // IPv6 localhost\r\n      /^::1$/,\r\n      /^0:0:0:0:0:0:0:1$/,\r\n\r\n      // IPv6 private ranges\r\n      /^fc00:/i, // Unique local address\r\n      /^fd00:/i, // Unique local address\r\n      /^fe80:/i, // Link-local address\r\n\r\n      // IPv6 loopback variations\r\n      /^0000:0000:0000:0000:0000:0000:0000:0001$/,\r\n    ];\r\n\r\n    return privateRanges.some((range) => range.test(ip));\r\n  }\r\n\r\n  private readonly mockLocations: GeoLocation[] = [\r\n    {\r\n      country: 'ID',\r\n      city: 'Jakarta',\r\n      latitude: -6.2088,\r\n      longitude: 106.8456,\r\n      timezone: 'Asia/Jakarta',\r\n    },\r\n    {\r\n      country: 'ID',\r\n      city: 'Surabaya',\r\n      latitude: -7.2575,\r\n      longitude: 112.7521,\r\n      timezone: 'Asia/Jakarta',\r\n    },\r\n    {\r\n      country: 'ID',\r\n      city: 'Bandung',\r\n      latitude: -6.9175,\r\n      longitude: 107.6191,\r\n      timezone: 'Asia/Jakarta',\r\n    },\r\n    {\r\n      country: 'SG',\r\n      city: 'Singapore',\r\n      latitude: 1.3521,\r\n      longitude: 103.8198,\r\n      timezone: 'Asia/Singapore',\r\n    },\r\n    {\r\n      country: 'US',\r\n      city: 'New York',\r\n      latitude: 40.7128,\r\n      longitude: -74.006,\r\n      timezone: 'America/New_York',\r\n    },\r\n  ];\r\n\r\n  private getNullLocation(): GeoLocation {\r\n    return {\r\n      country: null,\r\n      city: null,\r\n      latitude: null,\r\n      longitude: null,\r\n      timezone: null,\r\n    };\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}