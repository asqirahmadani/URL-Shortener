{"file":"D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\test\\unit\\auth.service.spec.ts","mappings":"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","names":[],"sources":["D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\test\\unit\\auth.service.spec.ts"],"sourcesContent":["import { ConflictException, UnauthorizedException } from '@nestjs/common';\r\nimport { Test, TestingModule } from '@nestjs/testing';\r\nimport { getRepositoryToken } from '@nestjs/typeorm';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { JwtService } from '@nestjs/jwt';\r\nimport { Repository } from 'typeorm';\r\nimport bcrypt from 'bcrypt';\r\n\r\nimport { User, UserRole } from '../../src/modules/auth/entities/user.entity';\r\nimport { AuthService } from '../../src/modules/auth/auth.service';\r\n\r\njest.mock('bcrypt');\r\n\r\ndescribe('AuthService', () => {\r\n  let service: AuthService;\r\n  let userRepository: Repository<User>;\r\n  let jwtService: JwtService;\r\n\r\n  const mockUserRepository = {\r\n    findOne: jest.fn(),\r\n    create: jest.fn(),\r\n    save: jest.fn(),\r\n    update: jest.fn(),\r\n  };\r\n\r\n  const mockJwtService = {\r\n    sign: jest.fn(),\r\n    verify: jest.fn(),\r\n  };\r\n\r\n  const mockConfigService = {\r\n    get: jest.fn((key: string) => {\r\n      const config = {\r\n        JWT_SECRET: 'test-secret',\r\n        JWT_REFRESH_SECRET: 'test-refresh-secret',\r\n      };\r\n      return config[key];\r\n    }),\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    const module: TestingModule = await Test.createTestingModule({\r\n      providers: [\r\n        AuthService,\r\n        {\r\n          provide: getRepositoryToken(User),\r\n          useValue: mockUserRepository,\r\n        },\r\n        {\r\n          provide: JwtService,\r\n          useValue: mockJwtService,\r\n        },\r\n        {\r\n          provide: ConfigService,\r\n          useValue: mockConfigService,\r\n        },\r\n      ],\r\n    }).compile();\r\n\r\n    service = module.get<AuthService>(AuthService);\r\n    userRepository = module.get(getRepositoryToken(User));\r\n    jwtService = module.get<JwtService>(JwtService);\r\n  });\r\n\r\n  afterEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('register', () => {\r\n    it('should register a new user', async () => {\r\n      const registerDto = {\r\n        email: 'test@example.com',\r\n        name: 'Test User',\r\n        password: 'Password123!',\r\n      };\r\n\r\n      const mockUser = {\r\n        id: 'uuid',\r\n        email: 'test@example.com',\r\n        name: 'Test User',\r\n        role: UserRole.USER,\r\n      };\r\n\r\n      mockUserRepository.findOne.mockResolvedValue(null);\r\n      (bcrypt.hash as jest.Mock).mockResolvedValue('hashed-password');\r\n      mockUserRepository.create.mockReturnValue(mockUser);\r\n      mockUserRepository.save.mockResolvedValue(mockUser);\r\n      mockJwtService.sign.mockReturnValue('access-token');\r\n\r\n      const result = await service.register(registerDto);\r\n\r\n      expect(result.user).toBeDefined();\r\n      expect(result.accessToken).toBeDefined();\r\n      expect(result.refreshToken).toBeDefined();\r\n      expect(mockUserRepository.save).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should throw ConflictException if email exists', async () => {\r\n      const registerDto = {\r\n        email: 'existing@example.com',\r\n        name: 'Test User',\r\n        password: 'Password123!',\r\n      };\r\n\r\n      mockUserRepository.findOne.mockResolvedValue({\r\n        email: 'existing@example.com',\r\n      });\r\n\r\n      await expect(service.register(registerDto)).rejects.toThrow(\r\n        ConflictException,\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('login', () => {\r\n    it('should login user with valid credentials', async () => {\r\n      const loginDto = {\r\n        email: 'test@example.com',\r\n        password: 'Password123!',\r\n      };\r\n\r\n      const mockUser = {\r\n        id: 'uuid',\r\n        email: 'test@example.com',\r\n        password: 'hashed-password',\r\n        isActive: true,\r\n      };\r\n\r\n      mockUserRepository.findOne.mockResolvedValue(mockUser);\r\n      (bcrypt.compare as jest.Mock).mockResolvedValue(true);\r\n      mockUserRepository.save.mockResolvedValue(mockUser);\r\n      mockJwtService.sign.mockReturnValue('token');\r\n\r\n      const result = await service.login(loginDto);\r\n\r\n      expect(result.user).toBeDefined();\r\n      expect(result.accessToken).toBeDefined();\r\n      expect(result.refreshToken).toBeDefined();\r\n    });\r\n\r\n    it('should throw UnauthorizedException for invalid email', async () => {\r\n      const loginDto = {\r\n        email: 'wrong@example.com',\r\n        password: 'Password123!',\r\n      };\r\n\r\n      mockUserRepository.findOne.mockResolvedValue(null);\r\n\r\n      await expect(service.login(loginDto)).rejects.toThrow(\r\n        UnauthorizedException,\r\n      );\r\n    });\r\n\r\n    it('should throw UnauthorizedException for invalid password', async () => {\r\n      const loginDto = {\r\n        email: 'test@example.com',\r\n        password: 'WrongPassword',\r\n      };\r\n\r\n      const mockUser = {\r\n        email: 'test@example.com',\r\n        password: 'hashed-password',\r\n        isActive: true,\r\n      };\r\n\r\n      mockUserRepository.findOne.mockResolvedValue(mockUser);\r\n      (bcrypt.compare as jest.Mock).mockResolvedValue(false);\r\n\r\n      await expect(service.login(loginDto)).rejects.toThrow(\r\n        UnauthorizedException,\r\n      );\r\n    });\r\n\r\n    it('should throw UnauthorizedException for inactive user', async () => {\r\n      const loginDto = {\r\n        email: 'test@example.com',\r\n        password: 'Password123!',\r\n      };\r\n\r\n      const mockUser = {\r\n        email: 'test@example.com',\r\n        password: 'hashed-password',\r\n        isActive: false,\r\n      };\r\n\r\n      mockUserRepository.findOne.mockResolvedValue(mockUser);\r\n\r\n      await expect(service.login(loginDto)).rejects.toThrow(\r\n        UnauthorizedException,\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('refreshAccessToken', () => {\r\n    it('should refresh access token with valid refresh token', async () => {\r\n      const refreshToken = 'valid-refresh-token';\r\n      const mockUser = {\r\n        id: 'uuid',\r\n        email: 'test@example.com',\r\n        refreshToken: 'hashed-refresh-token',\r\n      };\r\n\r\n      mockJwtService.verify.mockReturnValue({ sub: 'uuid' });\r\n      mockUserRepository.findOne.mockResolvedValue(mockUser);\r\n      (bcrypt.compare as jest.Mock).mockResolvedValue(true);\r\n      mockJwtService.sign.mockReturnValue('new-token');\r\n      (bcrypt.hash as jest.Mock).mockResolvedValue('new-hashed-token');\r\n      mockUserRepository.save.mockResolvedValue(mockUser);\r\n\r\n      const result = await service.refreshAccessToken(refreshToken);\r\n\r\n      expect(result.accessToken).toBeDefined();\r\n      expect(result.refreshToken).toBeDefined();\r\n    });\r\n\r\n    it('should throw UnauthorizedException for invalid refresh token', async () => {\r\n      mockJwtService.verify.mockImplementation(() => {\r\n        throw new Error('Invalid token');\r\n      });\r\n\r\n      await expect(service.refreshAccessToken('invalid-token')).rejects.toThrow(\r\n        UnauthorizedException,\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('logout', () => {\r\n    it('should logout user by clearing refresh token', async () => {\r\n      mockUserRepository.update.mockResolvedValue({});\r\n\r\n      await service.logout('user-id');\r\n\r\n      expect(mockUserRepository.update).toHaveBeenCalledWith('user-id', {\r\n        refreshToken: null,\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('validateUser', () => {\r\n    it('should return user if active', async () => {\r\n      const mockUser = {\r\n        id: 'uuid',\r\n        email: 'test@example.com',\r\n        isActive: true,\r\n      };\r\n\r\n      mockUserRepository.findOne.mockResolvedValue(mockUser);\r\n\r\n      const result = await service.validateUser('uuid');\r\n\r\n      expect(result).toEqual(mockUser);\r\n    });\r\n\r\n    it('should throw UnauthorizedException if user not found', async () => {\r\n      mockUserRepository.findOne.mockResolvedValue(null);\r\n\r\n      await expect(service.validateUser('invalid-id')).rejects.toThrow(\r\n        UnauthorizedException,\r\n      );\r\n    });\r\n\r\n    it('should throw UnauthorizedException if user inactive', async () => {\r\n      // In the real implementation, `findOne({ where: { id, isActive: true } })`\r\n      // will return null if the user has isActive: false.\r\n      // So we must mock that behavior here.\r\n      mockUserRepository.findOne.mockResolvedValue(null);\r\n\r\n      await expect(service.validateUser('uuid')).rejects.toThrow(\r\n        UnauthorizedException,\r\n      );\r\n    });\r\n  });\r\n});\r\n"],"version":3}