{"version":3,"names":["common_1","cov_gbv28come","s","require","typeorm_1","typeorm_2","click_entity_1","url_entity_1","AdminService","AdminService_1","urlRepository","clickRepository","logger","Logger","name","constructor","f","getSystemStats","totalUrls","count","activeUrls","where","isActive","expiredUrls","createQueryBuilder","now","Date","getCount","totalClicks","today","setHours","clicksToday","createdAt","weekAgo","setDate","getDate","clicksThisWeek","topUrls","find","order","clickCount","take","select","urls","total","active","expired","clicks","thisWeek","map","url","shortCode","getRecentActivity","limit","b","recentUrls","recentClicks","relations","exports","__decorate","Injectable","__param","InjectRepository","Url","Click","Repository","_a","Object","_b"],"sources":["D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\src\\modules\\admin\\admin.service.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\r\nimport { InjectRepository } from '@nestjs/typeorm';\r\nimport { Repository } from 'typeorm';\r\n\r\nimport { Click } from '../analytics/entities/click.entity';\r\nimport { Url } from '../url/entities/url.entity';\r\n\r\n/* \r\nAdmin Service - admin dashboard & management\r\n*/\r\n@Injectable()\r\nexport class AdminService {\r\n  private readonly logger = new Logger(AdminService.name);\r\n\r\n  constructor(\r\n    @InjectRepository(Url)\r\n    private readonly urlRepository: Repository<Url>,\r\n    @InjectRepository(Click)\r\n    private readonly clickRepository: Repository<Click>,\r\n  ) {}\r\n\r\n  /* \r\n    Get system statistics\r\n    */\r\n  async getSystemStats(): Promise<{\r\n    urls: { total: number; active: number; expired: number };\r\n    clicks: { total: number; today: number; thisWeek: number };\r\n    topUrls: Array<{ shortCode: string; clicks: number }>;\r\n  }> {\r\n    const totalUrls = await this.urlRepository.count();\r\n    const activeUrls = await this.urlRepository.count({\r\n      where: { isActive: true },\r\n    });\r\n\r\n    const expiredUrls = await this.urlRepository\r\n      .createQueryBuilder('url')\r\n      .where('url.expiresAt < :now', { now: new Date() })\r\n      .getCount();\r\n\r\n    const totalClicks = await this.clickRepository.count();\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n\r\n    const clicksToday = await this.clickRepository.count({\r\n      where: { createdAt: today },\r\n    });\r\n\r\n    const weekAgo = new Date();\r\n    weekAgo.setDate(weekAgo.getDate() - 7);\r\n    const clicksThisWeek = await this.clickRepository.count({\r\n      where: { createdAt: weekAgo },\r\n    });\r\n\r\n    const topUrls = await this.urlRepository.find({\r\n      order: { clickCount: 'DESC' },\r\n      take: 10,\r\n      select: ['shortCode', 'clickCount'],\r\n    });\r\n\r\n    return {\r\n      urls: {\r\n        total: totalUrls,\r\n        active: activeUrls,\r\n        expired: expiredUrls,\r\n      },\r\n      clicks: {\r\n        total: totalClicks,\r\n        today: clicksToday,\r\n        thisWeek: clicksThisWeek,\r\n      },\r\n      topUrls: topUrls.map((url) => ({\r\n        shortCode: url.shortCode,\r\n        clicks: url.clickCount,\r\n      })),\r\n    };\r\n  }\r\n\r\n  /* \r\n  Get recent activity\r\n  */\r\n  async getRecentActivity(limit: number = 20): Promise<{\r\n    recentUrls: Url[];\r\n    recentClicks: Click[];\r\n  }> {\r\n    const recentUrls = await this.urlRepository.find({\r\n      order: { createdAt: 'DESC' },\r\n      take: limit,\r\n    });\r\n\r\n    const recentClicks = await this.clickRepository.find({\r\n      order: { createdAt: 'DESC' },\r\n      take: limit,\r\n      relations: ['url'],\r\n    });\r\n\r\n    return {\r\n      recentUrls,\r\n      recentClicks,\r\n    };\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}