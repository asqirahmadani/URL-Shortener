{"file":"D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\test\\integration\\analytics.flow.spec.ts","mappings":"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","names":[],"sources":["D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\test\\integration\\analytics.flow.spec.ts"],"sourcesContent":["import { ConfigModule, ConfigService } from '@nestjs/config';\r\nimport { Test, TestingModule } from '@nestjs/testing';\r\nimport { getRepositoryToken } from '@nestjs/typeorm';\r\nimport { INestApplication } from '@nestjs/common';\r\nimport { TypeOrmModule } from '@nestjs/typeorm';\r\nimport { BullModule } from '@nestjs/bullmq';\r\nimport { Repository } from 'typeorm';\r\nimport * as dotenv from 'dotenv';\r\nimport * as path from 'path';\r\n\r\nimport { AnalyticsService } from '../../src/modules/analytics/analytics.service';\r\nimport { RateLimitModule } from '../../src/modules/rate-limit/rate-limit.module';\r\nimport { AnalyticsModule } from '../../src/modules/analytics/analytics.module';\r\nimport { Click } from '../../src/modules/analytics/entities/click.entity';\r\nimport { ApiKey } from '../../src/modules/auth/entities/api-key.entity';\r\nimport { User } from '../../src/modules/auth/entities/user.entity';\r\nimport { CacheModule } from '../../src/common/cache/cache.module';\r\nimport { Url } from '../../src/modules/url/entities/url.entity';\r\nimport { UrlService } from '../../src/modules/url/url.service';\r\nimport { UrlModule } from '../../src/modules/url/url.module';\r\n\r\ndotenv.config({ path: path.resolve(__dirname, '../../.env.test') });\r\n\r\ndescribe('Analytics Flow (Integration)', () => {\r\n  let app: INestApplication;\r\n  let analyticsService: AnalyticsService;\r\n  let urlService: UrlService;\r\n  let clickRepository: Repository<Click>;\r\n  let urlRepository: Repository<Url>;\r\n  let module: TestingModule;\r\n\r\n  beforeAll(async () => {\r\n    module = await Test.createTestingModule({\r\n      imports: [\r\n        ConfigModule.forRoot({\r\n          isGlobal: true,\r\n          envFilePath: '.env.test',\r\n        }),\r\n        TypeOrmModule.forRootAsync({\r\n          imports: [ConfigModule],\r\n          inject: [ConfigService],\r\n          useFactory: (configService: ConfigService) => ({\r\n            type: 'postgres',\r\n            host: configService.get<string>('DB_HOST', 'localhost'),\r\n            port: configService.get<number>('DB_PORT', 5433),\r\n            username: configService.get<string>('DB_USERNAME', 'test'),\r\n            password: configService.get<string>('DB_PASSWORD', 'test'),\r\n            database: configService.get<string>('DB_DATABASE', 'test_db'),\r\n            entities: [Url, Click, User, ApiKey],\r\n            synchronize: true,\r\n            dropSchema: true,\r\n          }),\r\n        }),\r\n        BullModule.forRootAsync({\r\n          imports: [ConfigModule],\r\n          inject: [ConfigService],\r\n          useFactory: (configService: ConfigService) => ({\r\n            connection: {\r\n              host: configService.get<string>('REDIS_HOST', 'localhost'),\r\n              port: configService.get<number>('REDIS_PORT', 6380),\r\n              password: configService.get<string>('REDIS_PASSWORD'),\r\n              maxRetriesPerRequest: null,\r\n            },\r\n          }),\r\n        }),\r\n        CacheModule,\r\n        UrlModule,\r\n        AnalyticsModule,\r\n        RateLimitModule,\r\n      ],\r\n    }).compile();\r\n\r\n    app = module.createNestApplication();\r\n    await app.init();\r\n\r\n    analyticsService = module.get<AnalyticsService>(AnalyticsService);\r\n    urlService = module.get<UrlService>(UrlService);\r\n    clickRepository = module.get<Repository<Click>>(getRepositoryToken(Click));\r\n    urlRepository = module.get<Repository<Url>>(getRepositoryToken(Url));\r\n  });\r\n\r\n  afterAll(async () => {\r\n    if (app) {\r\n      await app.close();\r\n    }\r\n    if (module) {\r\n      await module.close();\r\n    }\r\n  });\r\n\r\n  beforeEach(async () => {\r\n    await clickRepository.query('TRUNCATE \"clicks\" CASCADE');\r\n    await urlRepository.query('TRUNCATE \"urls\" CASCADE');\r\n  });\r\n\r\n  describe('Click Tracking Flow', () => {\r\n    it('should track click and update URL click count', async () => {\r\n      // 1. Create URL\r\n      const url = await urlService.createShortUrl({\r\n        originalUrl: 'https://example.com',\r\n      });\r\n\r\n      // 2. Process click event\r\n      const clickEvent = {\r\n        urlId: url.id,\r\n        ipAddress: '8.8.8.8',\r\n        userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0)',\r\n        referer: 'https://google.com',\r\n      };\r\n\r\n      await analyticsService.processClickEvent(clickEvent);\r\n\r\n      // 3. Verify click was saved\r\n      const clicks = await clickRepository.find({ where: { urlId: url.id } });\r\n      expect(clicks).toHaveLength(1);\r\n      expect(clicks[0].ipAddress).toBe('8.8.8.8');\r\n      expect(clicks[0].deviceType).toBe('mobile');\r\n      expect(clicks[0].browser).toBeDefined();\r\n\r\n      // 4. Verify URL click count incremented\r\n      const updatedUrl = await urlRepository.findOne({ where: { id: url.id } });\r\n      expect(updatedUrl!.clickCount).toBe(1);\r\n    });\r\n\r\n    it('should parse user agent correctly', async () => {\r\n      const url = await urlService.createShortUrl({\r\n        originalUrl: 'https://example.com',\r\n      });\r\n\r\n      const clickEvent = {\r\n        urlId: url.id,\r\n        ipAddress: '8.8.8.8',\r\n        userAgent:\r\n          'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\r\n        referer: '',\r\n      };\r\n\r\n      await analyticsService.processClickEvent(clickEvent);\r\n\r\n      const click = await clickRepository.findOne({ where: { urlId: url.id } });\r\n\r\n      expect(click!.browser).toBe('Chrome');\r\n      expect(click!.os).toBe('Windows');\r\n      expect(click!.deviceType).toBe('desktop');\r\n    });\r\n\r\n    it('should track multiple click from different sources', async () => {\r\n      const url = await urlService.createShortUrl({\r\n        originalUrl: 'https://example.com',\r\n      });\r\n\r\n      const clicks = [\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.8.8',\r\n          userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0)',\r\n          referer: 'https://google.com',\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '1.1.1.1',\r\n          userAgent: 'Mozilla/5.0 (Windows NT 10.0)',\r\n          referer: 'https://facebook.com',\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.4.4',\r\n          userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X)',\r\n          referer: 'https://twitter.com',\r\n        },\r\n      ];\r\n\r\n      for (const click of clicks) {\r\n        await analyticsService.processClickEvent(click);\r\n      }\r\n\r\n      const savedClicks = await clickRepository.find({\r\n        where: { urlId: url.id },\r\n      });\r\n      expect(savedClicks).toHaveLength(3);\r\n\r\n      const updatedUrl = await urlRepository.findOne({ where: { id: url.id } });\r\n      expect(updatedUrl!.clickCount).toBe(3);\r\n    });\r\n  });\r\n\r\n  describe('Analytics Overview', () => {\r\n    it('should return correct analytics overview', async () => {\r\n      const mockUser = { role: 'admin' };\r\n\r\n      // Create URL\r\n      const url = await urlService.createShortUrl({\r\n        originalUrl: 'https://example.com',\r\n      });\r\n\r\n      // Create multiple clicks\r\n      const clickEvents = [\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.8.8',\r\n          userAgent: 'Mozilla/5.0 (iPhone)',\r\n          referer: 'https://google.com',\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '1.1.1.1',\r\n          userAgent: 'Mozilla/5.0 (Windows)',\r\n          referer: 'https://facebook.com',\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.8.8', // Same IP (not unique)\r\n          userAgent: 'Mozilla/5.0 (iPhone)',\r\n          referer: 'https://twitter.com',\r\n        },\r\n      ];\r\n\r\n      for (const event of clickEvents) {\r\n        await analyticsService.processClickEvent(event);\r\n      }\r\n\r\n      // Get analytics overview\r\n      const overview = await analyticsService.getAnalyticsOverview(\r\n        url.shortCode,\r\n        mockUser,\r\n      );\r\n\r\n      expect(overview.totalClicks).toBe(3);\r\n      expect(overview.uniqueVisitors).toBe(2); // 2 unique IPs\r\n      expect(overview.createdAt).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('Timeline Analytics', () => {\r\n    it('should return timeline data grouped by day', async () => {\r\n      const mockUser = { role: 'admin' };\r\n\r\n      const url = await urlService.createShortUrl({\r\n        originalUrl: 'https://example.com',\r\n      });\r\n\r\n      // Create clicks on different days\r\n      const today = new Date();\r\n      const yesterday = new Date(today);\r\n      yesterday.setDate(yesterday.getDate() - 1);\r\n      const twoDaysAgo = new Date(today);\r\n      twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);\r\n\r\n      // Mock clicks with different timestamps\r\n      await clickRepository.save([\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.8.8',\r\n          createdAt: today,\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.8.8',\r\n          createdAt: today,\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.8.8',\r\n          createdAt: yesterday,\r\n        },\r\n      ]);\r\n\r\n      const timeline = await analyticsService.getTimelineData(\r\n        url.shortCode,\r\n        'day',\r\n        7,\r\n        mockUser,\r\n      );\r\n\r\n      expect(timeline.data).toBeDefined();\r\n      expect(timeline.interval).toBe('day');\r\n      expect(timeline.totalClicks).toBeGreaterThan(0);\r\n    });\r\n  });\r\n\r\n  describe('Location Analytics', () => {\r\n    it('should aggregate click by country', async () => {\r\n      const mockUser = { role: 'admin' };\r\n\r\n      const url = await urlService.createShortUrl({\r\n        originalUrl: 'https://example.com',\r\n      });\r\n\r\n      // Create clicks with geo data\r\n      const clicksWithGeo = [\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.8.8',\r\n          country: 'US',\r\n          city: 'Mountain View',\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '1.1.1.1',\r\n          country: 'US',\r\n          city: 'San Francisco',\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.4.4',\r\n          country: 'ID',\r\n          city: 'Jakarta',\r\n        },\r\n      ];\r\n\r\n      for (const click of clicksWithGeo) {\r\n        await clickRepository.save(click);\r\n      }\r\n\r\n      const locationStats = await analyticsService.getLocationStats(\r\n        url.shortCode,\r\n        mockUser,\r\n      );\r\n\r\n      expect(locationStats.countries).toHaveLength(2);\r\n      expect(locationStats.countries[0].clicks).toBeGreaterThan(0);\r\n      expect(locationStats.totalClicks).toBe(3);\r\n    });\r\n  });\r\n\r\n  describe('Device Analytics', () => {\r\n    it('should aggregate clicks by device type', async () => {\r\n      const mockUser = { role: 'admin' };\r\n\r\n      const url = await urlService.createShortUrl({\r\n        originalUrl: 'https://example.com',\r\n      });\r\n\r\n      const clickEvents = [\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.8.8',\r\n          userAgent: 'Mozilla/5.0 (iPhone)',\r\n          referer: '',\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '1.1.1.1',\r\n          userAgent: 'Mozilla/5.0 (iPhone)',\r\n          referer: '',\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.4.4',\r\n          userAgent: 'Mozilla/5.0 (Windows NT 10.0)',\r\n          referer: '',\r\n        },\r\n      ];\r\n\r\n      for (const event of clickEvents) {\r\n        await analyticsService.processClickEvent(event);\r\n      }\r\n\r\n      const deviceStats = await analyticsService.getDeviceStats(\r\n        url.shortCode,\r\n        mockUser,\r\n      );\r\n\r\n      expect(deviceStats.byType).toBeDefined();\r\n      expect(deviceStats.byBrowser).toBeDefined();\r\n      expect(deviceStats.byOS).toBeDefined();\r\n      expect(deviceStats.totalClicks).toBe(3);\r\n    });\r\n  });\r\n\r\n  describe('Referrer Analytics', () => {\r\n    it('should track and aggregate referrers', async () => {\r\n      const mockUser = { role: 'admin' };\r\n\r\n      const url = await urlService.createShortUrl({\r\n        originalUrl: 'https://example.com',\r\n      });\r\n\r\n      const clickEvents = [\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.8.8',\r\n          userAgent: 'Mozilla/5.0',\r\n          referer: 'https://google.com',\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '1.1.1.1',\r\n          userAgent: 'Mozilla/5.0',\r\n          referer: 'https://google.com',\r\n        },\r\n        {\r\n          urlId: url.id,\r\n          ipAddress: '8.8.4.4',\r\n          userAgent: 'Mozilla/5.0',\r\n          referer: 'https://facebook.com',\r\n        },\r\n      ];\r\n\r\n      for (const event of clickEvents) {\r\n        await analyticsService.processClickEvent(event);\r\n      }\r\n\r\n      const referrerStats = await analyticsService.getReferrerStats(\r\n        url.shortCode,\r\n        mockUser,\r\n      );\r\n\r\n      expect(referrerStats).toHaveLength(2);\r\n      expect(referrerStats[0].clicks).toBeGreaterThanOrEqual(1);\r\n    });\r\n  });\r\n\r\n  describe('Analytics Caching', () => {\r\n    it('should cache analytics overview and return from cache', async () => {\r\n      const mockUser = { role: 'admin' };\r\n\r\n      const url = await urlService.createShortUrl({\r\n        originalUrl: 'https://example.com',\r\n      });\r\n\r\n      // Create some clicks\r\n      await analyticsService.processClickEvent({\r\n        urlId: url.id,\r\n        ipAddress: '8.8.8.8',\r\n        userAgent: 'Mozilla/5.0',\r\n        referer: '',\r\n      });\r\n\r\n      // First call - should query DB\r\n      const overview1 = await analyticsService.getAnalyticsOverview(\r\n        url.shortCode,\r\n        mockUser,\r\n      );\r\n      expect(overview1.totalClicks).toBe(1);\r\n\r\n      // Add more clicks\r\n      await analyticsService.processClickEvent({\r\n        urlId: url.id,\r\n        ipAddress: '1.1.1.1',\r\n        userAgent: 'Mozilla/5.0',\r\n        referer: '',\r\n      });\r\n\r\n      // Second call immediately - should return cached (stale) data\r\n      const overview2 = await analyticsService.getAnalyticsOverview(\r\n        url.shortCode,\r\n        mockUser,\r\n      );\r\n\r\n      // Note: In real scenario with proper cache, this would still be 1 (cached)\r\n      // But with cache invalidation on click, it should be updated\r\n      expect(overview2.totalClicks).toBeGreaterThanOrEqual(1);\r\n    });\r\n  });\r\n\r\n  describe('Export Analytics', () => {\r\n    it('should export analytics data as CSV', async () => {\r\n      const mockUser = { role: 'admin' };\r\n\r\n      const url = await urlService.createShortUrl({\r\n        originalUrl: 'https://example.com',\r\n      });\r\n\r\n      // Create clicks\r\n      await analyticsService.processClickEvent({\r\n        urlId: url.id,\r\n        ipAddress: '8.8.8.8',\r\n        userAgent: 'Mozilla/5.0 (iPhone)',\r\n        referer: 'https://google.com',\r\n      });\r\n\r\n      const csv = await analyticsService.exportAnalytics(\r\n        url.shortCode,\r\n        mockUser,\r\n      );\r\n\r\n      expect(csv).toContain('Timestamp');\r\n      expect(csv).toContain('IP Address');\r\n      expect(csv).toContain('Country');\r\n      expect(csv).toContain('8.8.8.8');\r\n    });\r\n  });\r\n});\r\n"],"version":3}