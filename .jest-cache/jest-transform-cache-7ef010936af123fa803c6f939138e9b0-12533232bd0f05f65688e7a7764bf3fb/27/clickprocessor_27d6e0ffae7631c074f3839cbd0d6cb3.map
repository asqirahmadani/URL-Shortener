{"version":3,"names":["cov_20epicfqqv","actualCoverage","bullmq_1","s","require","common_1","bullmq_2","analytics_service_1","ClickProcessor","ClickProcessor_1","WorkerHost","analyticsService","logger","Logger","name","constructor","f","process","job","debug","id","b","handleRecordClick","warn","Error","data","urlId","processClickEvent","log","error","message","stack","onCompleted","onFailed","attemptsMade","exports","__decorate","OnWorkerEvent","Job","_b","Object","_c","_d","Processor","AnalyticsService","_a"],"sources":["D:\\Latihan\\Programming\\Dummy-Project\\url-shortener\\src\\modules\\analytics\\processors\\click.processor\\click.processor.ts"],"sourcesContent":["import { Processor, WorkerHost, OnWorkerEvent } from '@nestjs/bullmq';\r\nimport { Logger } from '@nestjs/common';\r\nimport { Job } from 'bullmq';\r\n\r\nimport { AnalyticsService } from '../../analytics.service';\r\nimport { ClickEventDto } from '../../dto/click-event.dto';\r\n\r\n/* \r\nClick Processor - BullMQ worker for click events process\r\n*/\r\n@Processor('clicks')\r\nexport class ClickProcessor extends WorkerHost {\r\n  private readonly logger = new Logger(ClickProcessor.name);\r\n\r\n  constructor(private readonly analyticsService: AnalyticsService) {\r\n    super();\r\n  }\r\n\r\n  /* \r\n  Main process method - handle all jobs from 'clicks' queue\r\n  */\r\n  async process(job: Job<ClickEventDto, any, string>): Promise<any> {\r\n    this.logger.debug(`Processing job ${job.id} of type ${job.name}`);\r\n\r\n    switch (job.name) {\r\n      case 'record-click':\r\n        return this.handleRecordClick(job);\r\n      default:\r\n        this.logger.warn(`Unknown job type: ${job.name}`);\r\n        throw new Error(`Unknown job type: ${job.name}`);\r\n    }\r\n  }\r\n\r\n  /* \r\n  Process click recording job\r\n  */\r\n  private async handleRecordClick(job: Job<ClickEventDto>): Promise<void> {\r\n    const { data } = job;\r\n\r\n    this.logger.debug(`Processing click job ${job.id} for URL ${data.urlId}`);\r\n\r\n    try {\r\n      await this.analyticsService.processClickEvent(data);\r\n      this.logger.log(`Successfully processed click job ${job.id}`);\r\n    } catch (error) {\r\n      this.logger.error(\r\n        `Failed to process click job ${job.id}: ${error.message}`,\r\n        error.stack,\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /* \r\n  Handle job completion\r\n  */\r\n  @OnWorkerEvent('completed')\r\n  onCompleted(job: Job) {\r\n    this.logger.debug(`Click job ${job.id} completed`);\r\n  }\r\n\r\n  /* \r\n  Handle job failure\r\n  */\r\n  @OnWorkerEvent('failed')\r\n  onFailed(job: Job, error: Error) {\r\n    if (job) {\r\n      this.logger.error(\r\n        `Click job ${job.id} failed after ${job.attemptsMade} attemps: ${error.message}`,\r\n      );\r\n    } else {\r\n      this.logger.error(`Job failed: ${error.message}`, error.stack);\r\n    }\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IACA;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AADA,MAAAE,QAAA;AAAA;AAAA,CAAAF,cAAA,GAAAG,CAAA,QAAAC,OAAA;AACA,MAAAC,QAAA;AAAA;AAAA,CAAAL,cAAA,GAAAG,CAAA,QAAAC,OAAA;AACA,MAAAE,QAAA;AAAA;AAAA,CAAAN,cAAA,GAAAG,CAAA,QAAAC,OAAA;AAEA,MAAAG,mBAAA;AAAA;AAAA,CAAAP,cAAA,GAAAG,CAAA,QAAAC,OAAA;AAGA;;;AAIO,IAAMI,cAAc;AAAA;AAAA,CAAAR,cAAA,GAAAG,CAAA,QAAAM,gBAAA,GAApB,MAAMD,cAAe,SAAQN,QAAA,CAAAQ,UAAU;EAGfC,gBAAA;EAFZC,MAAM;EAAA;EAAA,CAAAZ,cAAA,GAAAG,CAAA,QAAG,IAAIE,QAAA,CAAAQ,MAAM,CAACJ,gBAAc,CAACK,IAAI,CAAC;EAEzDC,YAA6BJ,gBAAkC;IAAA;IAAAX,cAAA,GAAAgB,CAAA;IAAAhB,cAAA,GAAAG,CAAA;IAC7D,KAAK,EAAE;IAAC;IAAAH,cAAA,GAAAG,CAAA;IADmB,KAAAQ,gBAAgB,GAAhBA,gBAAgB;EAE7C;EAEA;;;EAGA,MAAMM,OAAOA,CAACC,GAAoC;IAAA;IAAAlB,cAAA,GAAAgB,CAAA;IAAAhB,cAAA,GAAAG,CAAA;IAChD,IAAI,CAACS,MAAM,CAACO,KAAK,CAAC,kBAAkBD,GAAG,CAACE,EAAE,YAAYF,GAAG,CAACJ,IAAI,EAAE,CAAC;IAAC;IAAAd,cAAA,GAAAG,CAAA;IAElE,QAAQe,GAAG,CAACJ,IAAI;MACd,KAAK,cAAc;QAAA;QAAAd,cAAA,GAAAqB,CAAA;QAAArB,cAAA,GAAAG,CAAA;QACjB,OAAO,IAAI,CAACmB,iBAAiB,CAACJ,GAAG,CAAC;MACpC;QAAA;QAAAlB,cAAA,GAAAqB,CAAA;QAAArB,cAAA,GAAAG,CAAA;QACE,IAAI,CAACS,MAAM,CAACW,IAAI,CAAC,qBAAqBL,GAAG,CAACJ,IAAI,EAAE,CAAC;QAAC;QAAAd,cAAA,GAAAG,CAAA;QAClD,MAAM,IAAIqB,KAAK,CAAC,qBAAqBN,GAAG,CAACJ,IAAI,EAAE,CAAC;IACpD;EACF;EAEA;;;EAGQ,MAAMQ,iBAAiBA,CAACJ,GAAuB;IAAA;IAAAlB,cAAA,GAAAgB,CAAA;IACrD,MAAM;MAAES;IAAI,CAAE;IAAA;IAAA,CAAAzB,cAAA,GAAAG,CAAA,QAAGe,GAAG;IAAC;IAAAlB,cAAA,GAAAG,CAAA;IAErB,IAAI,CAACS,MAAM,CAACO,KAAK,CAAC,wBAAwBD,GAAG,CAACE,EAAE,YAAYK,IAAI,CAACC,KAAK,EAAE,CAAC;IAAC;IAAA1B,cAAA,GAAAG,CAAA;IAE1E,IAAI;MAAA;MAAAH,cAAA,GAAAG,CAAA;MACF,MAAM,IAAI,CAACQ,gBAAgB,CAACgB,iBAAiB,CAACF,IAAI,CAAC;MAAC;MAAAzB,cAAA,GAAAG,CAAA;MACpD,IAAI,CAACS,MAAM,CAACgB,GAAG,CAAC,oCAAoCV,GAAG,CAACE,EAAE,EAAE,CAAC;IAC/D,CAAC,CAAC,OAAOS,KAAK,EAAE;MAAA;MAAA7B,cAAA,GAAAG,CAAA;MACd,IAAI,CAACS,MAAM,CAACiB,KAAK,CACf,+BAA+BX,GAAG,CAACE,EAAE,KAAKS,KAAK,CAACC,OAAO,EAAE,EACzDD,KAAK,CAACE,KAAK,CACZ;MAAC;MAAA/B,cAAA,GAAAG,CAAA;MACF,MAAM0B,KAAK;IACb;EACF;EAEA;;;EAIAG,WAAWA,CAACd,GAAQ;IAAA;IAAAlB,cAAA,GAAAgB,CAAA;IAAAhB,cAAA,GAAAG,CAAA;IAClB,IAAI,CAACS,MAAM,CAACO,KAAK,CAAC,aAAaD,GAAG,CAACE,EAAE,YAAY,CAAC;EACpD;EAEA;;;EAIAa,QAAQA,CAACf,GAAQ,EAAEW,KAAY;IAAA;IAAA7B,cAAA,GAAAgB,CAAA;IAAAhB,cAAA,GAAAG,CAAA;IAC7B,IAAIe,GAAG,EAAE;MAAA;MAAAlB,cAAA,GAAAqB,CAAA;MAAArB,cAAA,GAAAG,CAAA;MACP,IAAI,CAACS,MAAM,CAACiB,KAAK,CACf,aAAaX,GAAG,CAACE,EAAE,iBAAiBF,GAAG,CAACgB,YAAY,aAAaL,KAAK,CAACC,OAAO,EAAE,CACjF;IACH,CAAC,MAAM;MAAA;MAAA9B,cAAA,GAAAqB,CAAA;MAAArB,cAAA,GAAAG,CAAA;MACL,IAAI,CAACS,MAAM,CAACiB,KAAK,CAAC,eAAeA,KAAK,CAACC,OAAO,EAAE,EAAED,KAAK,CAACE,KAAK,CAAC;IAChE;EACF;CACD;AAAA;AAAA/B,cAAA,GAAAG,CAAA;AA/DYgC,OAAA,CAAA3B,cAAA,GAAAA,cAAA;AAAc;AAAAR,cAAA,GAAAG,CAAA;AA8CzBiC,UAAA,EADC,IAAAlC,QAAA,CAAAmC,aAAa,EAAC,WAAW,CAAC,E;;qCACV/B,QAAA,CAAAgC,GAAG;AAAA;AAAA,CAAAtC,cAAA,GAAAqB,CAAA,WAAHf,QAAA,CAAAgC,GAAG;AAAA;AAAA,CAAAtC,cAAA,GAAAqB,CAAA,WAAAkB,EAAA;AAAA;AAAA,CAAAvC,cAAA,GAAAqB,CAAA,WAAAmB,MAAA,K,wFAEnB;AAAA;AAAAxC,cAAA,GAAAG,CAAA;AAMDiC,UAAA,EADC,IAAAlC,QAAA,CAAAmC,aAAa,EAAC,QAAQ,CAAC,E;;qCACV/B,QAAA,CAAAgC,GAAG;AAAA;AAAA,CAAAtC,cAAA,GAAAqB,CAAA,WAAHf,QAAA,CAAAgC,GAAG;AAAA;AAAA,CAAAtC,cAAA,GAAAqB,CAAA,WAAAoB,EAAA;AAAA;AAAA,CAAAzC,cAAA,GAAAqB,CAAA,WAAAmB,MAAA,WAAAE,EAAA;AAAA;AAAA,CAAA1C,cAAA,GAAAqB,CAAA,kBAASG,KAAK;AAAA;AAAA,CAAAxB,cAAA,GAAAqB,CAAA,WAALG,KAAK;AAAA;AAAA,CAAAxB,cAAA,GAAAqB,CAAA,WAAAqB,EAAA;AAAA;AAAA,CAAA1C,cAAA,GAAAqB,CAAA,WAAAmB,MAAA,K,qFAQ9B;AAAA;AAAAxC,cAAA,GAAAG,CAAA;yBA9DUK,cAAc,GAAAC,gBAAA,GAAA2B,UAAA,EAD1B,IAAAlC,QAAA,CAAAyC,SAAS,EAAC,QAAQ,CAAC,E;;qCAI6BpC,mBAAA,CAAAqC,gBAAgB;AAAA;AAAA,CAAA5C,cAAA,GAAAqB,CAAA,WAAhBd,mBAAA,CAAAqC,gBAAgB;AAAA;AAAA,CAAA5C,cAAA,GAAAqB,CAAA,WAAAwB,EAAA;AAAA;AAAA,CAAA7C,cAAA,GAAAqB,CAAA,WAAAmB,MAAA,I,EAHpDhC,cAAc,CA+D1B","ignoreList":[]}